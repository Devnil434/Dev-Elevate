<!DOCTYPE html>
<html>
<head>
    <title>GitHub Test - Debug GitHub Connection</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { padding: 10px 20px; margin: 10px; font-size: 16px; }
        #result { margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 5px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        .warning { background: #fff3e0; color: #f57c00; }
    </style>
</head>
<body>
    <h1>GitHub API Test</h1>
    
    <div>
        <button onclick="testGitHubEndpoint()">Test GitHub Endpoint (No Auth)</button>
        <button onclick="testGitHubAuth()">Test GitHub Auth (Requires Login)</button>
        <button onclick="testGitHubStatus()">Test GitHub Status (Requires Login)</button>
    </div>
    
    <div id="result"></div>

    <script>
        async function testGitHubEndpoint() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<div>Testing GitHub endpoint... Please wait</div>';
            
            try {
                console.log('üîÑ Testing GitHub test endpoint...');
                
                const response = await fetch('http://localhost:5000/api/github-test', {
                    method: 'GET'
                });
                
                console.log('üì° Response status:', response.status);
                
                const data = await response.json();
                console.log('üì¶ Response data:', data);
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h3>‚úÖ GitHub Test Endpoint Working!</h3>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <h3>‚ùå Test Failed</h3>
                            <p>Status: ${response.status}</p>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('‚ùå Error:', error);
                resultDiv.innerHTML = `
                    <div class="error">
                        <h3>‚ùå Network Error</h3>
                        <p>${error.message}</p>
                        <p>Make sure the backend server is running on port 5000</p>
                    </div>
                `;
            }
        }

        async function testGitHubAuth() {
            const resultDiv = document.getElementById('result');
            const token = localStorage.getItem('token');
            
            if (!token) {
                resultDiv.innerHTML = `
                    <div class="warning">
                        <h3>‚ö†Ô∏è No Auth Token</h3>
                        <p>Please log in to the main application first to get an auth token.</p>
                        <p>Then come back and try this test.</p>
                    </div>
                `;
                return;
            }
            
            resultDiv.innerHTML = '<div>Testing GitHub auth... Please wait</div>';
            
            try {
                console.log('üîÑ Testing GitHub auth endpoint...');
                console.log('üîë Using token:', token.substring(0, 20) + '...');
                
                const response = await fetch('http://localhost:5000/api/integrations/github/auth', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                console.log('üì° Response status:', response.status);
                
                const data = await response.json();
                console.log('üì¶ Response data:', data);
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h3>‚úÖ GitHub Auth Endpoint Working!</h3>
                            <p>Auth URL Generated Successfully</p>
                            <a href="${data.authUrl}" target="_blank" class="btn">üîó Open GitHub OAuth (Test)</a>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <h3>‚ùå Auth Test Failed</h3>
                            <p>Status: ${response.status}</p>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('‚ùå Error:', error);
                resultDiv.innerHTML = `
                    <div class="error">
                        <h3>‚ùå Network Error</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        async function testGitHubStatus() {
            const resultDiv = document.getElementById('result');
            const token = localStorage.getItem('token');
            
            if (!token) {
                resultDiv.innerHTML = `
                    <div class="warning">
                        <h3>‚ö†Ô∏è No Auth Token</h3>
                        <p>Please log in to the main application first.</p>
                    </div>
                `;
                return;
            }
            
            resultDiv.innerHTML = '<div>Testing GitHub status... Please wait</div>';
            
            try {
                console.log('üîÑ Testing GitHub status endpoint...');
                
                const response = await fetch('http://localhost:5000/api/integrations/github/status', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                console.log('üì° Response status:', response.status);
                
                const data = await response.json();
                console.log('üì¶ Response data:', data);
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h3>‚úÖ GitHub Status Working!</h3>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <h3>‚ùå Status Test Failed</h3>
                            <p>Status: ${response.status}</p>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('‚ùå Error:', error);
                resultDiv.innerHTML = `
                    <div class="error">
                        <h3>‚ùå Network Error</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // Check for auth token on page load
        window.onload = function() {
            const token = localStorage.getItem('token');
            if (token) {
                console.log('‚úÖ Auth token found in localStorage');
            } else {
                console.log('‚ùå No auth token found in localStorage');
                const resultDiv = document.getElementById('result');
                resultDiv.innerHTML = `
                    <div class="warning">
                        <h3>‚ÑπÔ∏è Info</h3>
                        <p>To test GitHub auth functionality, please:</p>
                        <ol>
                            <li>Go to <a href="http://localhost:5174" target="_blank">http://localhost:5174</a></li>
                            <li>Register/Login to get an auth token</li>
                            <li>Come back to this page</li>
                            <li>Use the "Test GitHub Auth" button</li>
                        </ol>
                        <p>For now, you can use "Test GitHub Endpoint" which doesn't require auth.</p>
                    </div>
                `;
            }
        };
    </script>
</body>
</html>
